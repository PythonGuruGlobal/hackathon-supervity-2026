# RAG System Architecture - Visual Guide

## High-Level Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MARKET DATA SOURCES                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Historical Dataset   â”‚  Live API (Alpha Vantage)                â”‚
â”‚ - OHLCV             â”‚  - Real-time prices                       â”‚
â”‚ - Technical Indic.  â”‚  - Volume data                            â”‚
â”‚ - Sentiment         â”‚  - Daily updates                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FORECASTING ENGINE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ARIMA / Prophet Model                                          â”‚
â”‚  â†’ Predicts next-day close price                                â”‚
â”‚  â†’ Calculates confidence intervals                              â”‚
â”‚  â†’ Computes metrics (volatility, trend, % change)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ALERT AGENT (Decision Logic)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Evaluates:                                                     â”‚
â”‚  â€¢ Price change threshold (Â±4-5%)                               â”‚
â”‚  â€¢ Volatility levels (>3%)                                      â”‚
â”‚  â€¢ Trend reversals                                              â”‚
â”‚  â€¢ Alert cooldown & suppression                                 â”‚
â”‚                                                                 â”‚
â”‚  Output: AlertDecision with confidence & reasoning              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
                    â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    CURRENT METRICS        â”‚   â”‚   ALERT DECISION     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â€¢ Last close              â”‚   â”‚ â€¢ Should alert?      â”‚
    â”‚ â€¢ Predicted close         â”‚   â”‚ â€¢ Alert type         â”‚
    â”‚ â€¢ % change                â”‚   â”‚ â€¢ Confidence level   â”‚
    â”‚ â€¢ Volatility              â”‚   â”‚ â€¢ Reason             â”‚
    â”‚ â€¢ Trend direction         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ðŸ” RAG SYSTEM (CORE)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  RETRIEVAL COMPONENTS                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  1. PATTERN MATCHER                                     â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚     â”‚ Historical Database                â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ All past OHLCV data              â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Calculated indicators            â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Feature similarity search        â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Euclidean distance ranking       â”‚             â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                    â†“                                    â”‚   â”‚
â”‚  â”‚     Returns: Top-K similar historical days             â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  2. ALERT RETRIEVER                                     â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚     â”‚ Alert History Database             â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Past alert decisions             â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Alert outcomes                   â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Filter by type & recency         â”‚             â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                    â†“                                    â”‚   â”‚
â”‚  â”‚     Returns: Relevant past alerts                      â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  3. KNOWLEDGE RETRIEVER                                 â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚     â”‚ Vector Store (ChromaDB)            â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Market domain knowledge          â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Pattern explanations             â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Technical indicator guides       â”‚             â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Semantic / keyword search        â”‚             â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                    â†“                                    â”‚   â”‚
â”‚  â”‚     Returns: Relevant market insights                  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CONTEXT AGGREGATOR                                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â€¢ Combines all retrieved information                  â”‚   â”‚
â”‚  â”‚  â€¢ Calculates relevance score (0-1)                    â”‚   â”‚
â”‚  â”‚  â€¢ Formats for LLM consumption                         â”‚   â”‚
â”‚  â”‚  â€¢ Deduplicates & ranks by importance                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  RETRIEVED CONTEXT      â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ Similar patterns (5)  â”‚
                    â”‚ â€¢ Past alerts (5)       â”‚
                    â”‚ â€¢ Market insights (3)   â”‚
                    â”‚ â€¢ Relevance: 0.75       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ðŸ’¬ LLM EXPLAINER (Enhanced)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PROMPT CONSTRUCTION:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ System: You are a financial analyst...                â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚ Alert: price_drop, High confidence                    â”‚     â”‚
â”‚  â”‚ Metrics:                                               â”‚     â”‚
â”‚  â”‚   - Last: $150.00 â†’ Predicted: $144.00                â”‚     â”‚
â”‚  â”‚   - Change: -4.0%                                      â”‚     â”‚
â”‚  â”‚   - Volatility: 0.035                                  â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚ [RAG CONTEXT INSERTED HERE]                            â”‚     â”‚
â”‚  â”‚ Historical Patterns:                                   â”‚     â”‚
â”‚  â”‚   1. 2024-03-15: -4.2% (vol: 0.032)                   â”‚     â”‚
â”‚  â”‚   2. 2024-01-22: -4.8% (vol: 0.028)                   â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚ Past Alerts:                                           â”‚     â”‚
â”‚  â”‚   1. price_drop - Similar scenario 2 weeks ago        â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚ Market Context:                                        â”‚     â”‚
â”‚  â”‚   - Price drops >4% indicate significant events       â”‚     â”‚
â”‚  â”‚   - Historical 70% followed by volatility             â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚ Explain this alert professionally...                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                           â†“                                     â”‚
â”‚                    OpenAI GPT-4 / GPT-4o-mini                   â”‚
â”‚                           â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ GENERATED EXPLANATION:                                â”‚     â”‚
â”‚  â”‚                                                        â”‚     â”‚
â”‚  â”‚ "The forecast indicates a sharp 4.0% drop from        â”‚     â”‚
â”‚  â”‚  $150.00 to $144.00, with elevated volatility at      â”‚     â”‚
â”‚  â”‚  0.035. Historical analysis shows similar patterns    â”‚     â”‚
â”‚  â”‚  on March 15 (-4.2%) and January 22 (-4.8%), both    â”‚     â”‚
â”‚  â”‚  followed by continued pressure. This magnitude,      â”‚     â”‚
â”‚  â”‚  combined with current volatility levels, warrants    â”‚     â”‚
â”‚  â”‚  attention from risk management teams."               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTPUT & STORAGE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Alert notification sent                                      â”‚
â”‚  â€¢ Explanation logged to JSON/CSV                               â”‚
â”‚  â€¢ Added to alert history for future RAG                        â”‚
â”‚  â€¢ Dashboard updated                                            â”‚
â”‚  â€¢ Memory updated for suppression logic                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Detail

### Without RAG (Traditional)
```
Metrics â†’ LLM â†’ Explanation
         â†‘
   Generic prompt only
```

### With RAG (Enhanced)
```
Metrics â†’ RAG Retrieval â†’ Context + Metrics â†’ LLM â†’ Better Explanation
          â†“
    Historical patterns
    Past alerts
    Domain knowledge
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MarketRAGSystem  â”‚â—„â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
         â”‚                â”‚
         â”‚ initialized by â”‚
         â”‚                â”‚
         â–¼                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  LLMExplainer    â”‚â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ calls
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AlertAgent      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure

```
53_shaik_shaafiya/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ rag_system.py          â† RAG core implementation
â”‚   â”œâ”€â”€ llm_explainer.py       â† LLM with RAG integration
â”‚   â”œâ”€â”€ agent_logic.py         â† Decision making
â”‚   â”œâ”€â”€ forecaster.py          â† Time-series models
â”‚   â””â”€â”€ test_rag_system.py     â† Tests
â”‚
â”œâ”€â”€ knowledge_base/            â† Domain knowledge
â”‚   â”œâ”€â”€ price_patterns.md
â”‚   â”œâ”€â”€ volatility_insights.md
â”‚   â””â”€â”€ technical_indicators.md
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ stock_market_dataset.csv  â† Historical data
â”‚
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ alerts.json            â† Alert history (RAG source)
â”‚   â””â”€â”€ alerts.csv
â”‚
â”œâ”€â”€ RAG_INTEGRATION.md         â† Full documentation
â”œâ”€â”€ RAG_QUICKSTART.md          â† Quick reference
â””â”€â”€ demo_rag.py                â† Demonstration script
```

## Similarity Search Algorithm

```python
# Simplified version of pattern matching

current_features = [
    percent_change,     # e.g., -4.0%
    volatility          # e.g., 0.035
]

for historical_row in database:
    historical_features = [
        row.percent_change,
        row.volatility
    ]
    
    # Euclidean distance
    distance = sqrt(
        (current_features[0] - historical_features[0])Â² +
        (current_features[1] - historical_features[1])Â² * 100
    )
    
    similarity_score = distance  # Lower = more similar

# Return top-K lowest distances (most similar)
```

## Relevance Score Calculation

```python
relevance_score = 0.0

# Pattern quality (40%)
if similar_patterns:
    avg_similarity = mean(p.similarity_score for p in patterns)
    pattern_score = max(0, 1 - avg_similarity/10)
    relevance_score += pattern_score * 0.4

# Alert history (30%)
if past_alerts:
    alert_score = min(len(past_alerts) / 5, 1.0)
    relevance_score += alert_score * 0.3

# Knowledge depth (30%)
if market_insights:
    insight_score = min(len(market_insights) / 3, 1.0)
    relevance_score += insight_score * 0.3

return min(relevance_score, 1.0)
```

## Example: Complete Flow for Price Drop Alert

```
1. Forecaster predicts: $150 â†’ $144 (-4.0%)
                        â†“
2. Alert Agent decides: TRIGGER (exceeds -4% threshold)
                        â†“
3. RAG System retrieves:
   â€¢ Pattern: 2024-03-15: -4.2% (similar!)
   â€¢ Alert: Previous price_drop 2 weeks ago
   â€¢ Insight: "Drops >4% indicate significant events"
                        â†“
4. Context formatted:
   "Historical Patterns: 2024-03-15: -4.2%..."
                        â†“
5. LLM generates with context:
   "The 4.0% drop is significant. Historical analysis 
    shows similar pattern on March 15 (-4.2%)..."
                        â†“
6. Output: Enhanced explanation with factual grounding
```

## Benefits Visualization

### Traditional Approach
```
Input â†’ LLM â†’ Output
        â†“
   May hallucinate
   No historical context
   Generic explanations
```

### RAG Approach
```
Input â†’ Retrieve Facts â†’ Augment Prompt â†’ LLM â†’ Output
        â†“                â†“                       â†“
   Real data        Grounded context    Factual explanation
   Similar cases    Historical patterns Reduced hallucinations
   Domain knowledge Alert precedents    Better quality
```

---

**Key Takeaway**: RAG transforms the LLM from a generic text generator into a context-aware analyst that references actual historical data and domain knowledge.
